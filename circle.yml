general:
  branches:
    only:
      - staging
      - development
      - production

machine:
  timezone:
    America/Los_Angeles
  node:
    version: 7.6.0

dependencies:
  pre:
    - openssl aes-256-cbc -d -in ./deployment/config/aws.$CIRCLE_BRANCH.encrypted -k $SIX_SKELETON_KEY >> ~/.circlerc
    - aws configure set preview.cloudfront true
  post:
    - echo "$AWS_ACCOUNT $AWS_REGION $AWS_ACCESS_KEY_ID $AWS_SECRET_ACCESS_KEY"

test:
  override:
    - "true"

deployment:
  production:
    branch: production
    commands:
      - ./deployment/build.sh admin.sixcrm.com production

  staging:
    branch: staging
    commands:
      - ./deployment/build.sh admin.sixcrm.com staging
      - ./deployment/merge_branches.sh staging production

  development:
    branch: development
    commands:
      - ./deployment/build.sh admin.sixcrm.com development
      - ./deployment/merge_branches.sh development staging
