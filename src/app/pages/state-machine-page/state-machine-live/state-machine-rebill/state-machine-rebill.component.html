<div class="flex-custom">
  <div class="column--small">
    <mat-card class="customer-view__card">
      <mat-card-title>
        <div class="title">{{'ORDERENGINE_REBILL_HISTORY_TITLE' | translate}}</div>
        <div class="subtitle">{{'ORDERENGINE_REBILL_HISTORY_SUBTITLE' | translate}}</div>
      </mat-card-title>

      <mat-card-content class="history-container">
        <div class="flex-custom" *ngFor="let event of rebill.history; let i = index">

          <div>
            <mat-icon class="warning-icon" *ngIf="event.errorMessage">warning</mat-icon>
            <div *ngIf="!event.errorMessage && event.enteredAt" class="done-icon">
              <mat-icon>done</mat-icon>
            </div>
            <div class="number-icon" *ngIf="!event.errorMessage && !event.enteredAt">
              <div>{{i + 1}}</div>
            </div>

            <div *ngIf="i < rebill.history.length - 1" class="line"></div>
          </div>

          <div class="info-container">
            <div class="name">{{event.state}}</div>
            <div class="time" *ngIf="event.enteredAt">
              <div>{{'ORDERENGINE_REBILL_HISTORY_ENTER' | translate}} {{event.state}}:</div>
              {{event.enteredAt.format('MM/DD/YYYY h:mm a')}}
            </div>
            <div class="warning" *ngIf="event.errorMessage">{{event.errorMessage}}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="column--large">
    <mat-card class="customer-view__card">
      <mat-card-title>
        <div class="title">Customer Information</div>
        <div class="subtitle">Address where fulfillment will ship packages</div>
        <div *ngIf="rebill.parentSession.customer.id">
          <mat-icon [matMenuTriggerFor]="shipOptions">more_vert</mat-icon>
          <mat-menu #shipOptions="matMenu" x-position="before">
            <button md-menu-item [routerLink]="['/customers', rebill.parentSession.customer.id]"> View Customer </button>
          </mat-menu>
        </div>
      </mat-card-title>

      <mat-card-content>
        <div>
          <div class="half">
            <mat-input-container class="full">
              <input required disabled matInput name="fullName" placeholder="{{'FORMINPUTS_FULLNAME' | translate}}" [(ngModel)]="rebill.parentSession.customer.fullName">
            </mat-input-container>
          </div>

          <div class="flex-custom full">
            <mat-input-container class="half">
              <input required disabled matInput name="address" placeholder="{{'FORMINPUTS_ADDRESS' | translate}}" [(ngModel)]="rebill.parentSession.customer.address.line1">
            </mat-input-container>
            <mat-input-container class="half space-left">
              <input required disabled matInput name="city" placeholder="{{'FORMINPUTS_CITY' | translate}}" [(ngModel)]="rebill.parentSession.customer.address.city">
            </mat-input-container>
          </div>

          <div class="flex-custom full">
            <div class="flex-custom half">
              <mat-input-container class="half">
                <input required disabled matInput name="state" placeholder="{{'FORMINPUTS_STATE' | translate}}" [(ngModel)]="rebill.parentSession.customer.address.state">
              </mat-input-container>

              <mat-input-container class="half space-left">
                <input required disabled matInput name="postalCode" placeholder="{{'FORMINPUTS_ZIP' | translate}}" [(ngModel)]="rebill.parentSession.customer.address.zip">
              </mat-input-container>
            </div>

            <mat-input-container class="half space-left">
              <input required disabled matInput name="country" placeholder="{{'FORMINPUTS_COUNTRY' | translate}}" [(ngModel)]="rebill.parentSession.customer.address.country">
            </mat-input-container>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <customer-credit-card-view
      [class.customer-credit-card-view--multiple]="rebill.parentSession.customer.creditCards.length > 1"
      [creditCards]="rebill.parentSession.customer.creditCards"
      [ripped]="true">
    </customer-credit-card-view>
  </div>

  <div class="column--medium">

    <mat-card class="customer-view__card">
      <mat-card-title>
        <div class="title">{{'ORDERENGINE_REBILL_PROPERTIES_TITLE' | translate}}</div>
        <div class="subtitle">{{'ORDERENGINE_REBILL_PROPERTIES_SUBTITLE' | translate}}</div>
      </mat-card-title>

      <mat-card-content class="properties-container">
        <div><span>{{'ORDERENGINE_REBILL_PROPERTIES_REBILL' | translate}}:</span>{{rebill.id}}</div>
        <div class="clickable" [routerLink]="['/sessions', rebill.parentSession.id]"><span>{{'ORDERENGINE_REBILL_PROPERTIES_PARENTSESSION' | translate}}:</span>{{rebill.parentSession.id}}</div>
        <div><span>{{'ORDERENGINE_REBILL_PROPERTIES_CREATED' | translate}}:</span>{{rebill.createdAt.tz(authService.getTimezone()).format('MM/DD/YYYY h:mm a')}}</div>
        <div><span>{{'ORDERENGINE_REBILL_PROPERTIES_UPDATED' | translate}}:</span>{{rebill.updatedAt.tz(authService.getTimezone()).format('MM/DD/YYYY h:mm a')}}</div>
        <div><span>{{'ORDERENGINE_REBILL_PROPERTIES_AMOUNT' | translate}}:</span>{{rebill.amount.usd() | numberlocale}}</div>
        <div class="clickable" [routerLink]="['/campaigns', rebill.parentSession.campaign.id]"><span>{{'ORDERENGINE_REBILL_PROPERTIES_CAMPAIGN' | translate}}:</span>{{rebill.parentSession.campaign.name}}</div>
      </mat-card-content>
    </mat-card>

    <table-memory [data]="getSchedules()"
                  [columnParams]="columnParams"
                  [textOptions]="textOptions"
                  [dissociationEnabled]="false"
                  [associationEnabled]="false"
                  [showPagination]="false"
                  [filterEnabled]="false"
                  (view)="viewProduct($event)">
    </table-memory>
  </div>

</div>
