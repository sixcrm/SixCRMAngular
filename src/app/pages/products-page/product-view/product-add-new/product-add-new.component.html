<form *ngIf="entity" #productInputForm="ngForm" class="flex-custom">
  <div style="margin-bottom: 120px;" class="entity-view__card" [class.entity-view__card--create]="mode === add" [class.flex-align--center]="mode === add">
    <div class="entity-view__card__header">
      <div class="entity-view__card__header__title">{{(mode === add ? 'PRODUCT_INFO_CREATETITLE' : 'PRODUCT_INFO_TITLE') | translate}}</div>
      <ng-container *ngIf="mode === view">
        <md-icon [md-menu-trigger-for]="editOptions">more_vert</md-icon>
        <md-menu #editOptions="mdMenu" x-position="before">
          <button md-menu-item (click)="changeMode.emit(update)">{{'PRODUCT_INFO_EDIT' | translate}}</button>
          <button md-menu-item (click)="deleteEntity.emit(entity)">{{'PRODUCT_INFO_DEL' | translate}}</button>
          <button md-menu-item *ngIf="entity.ship && entity.fulfillmentProvider && entity.fulfillmentProvider.id" [routerLink]="['/fulfillmentproviders', entity.fulfillmentProvider.id]">
            {{'PRODUCT_INFO_VIEWFULFILLMENTPROVIDER' | translate}}
          </button>
        </md-menu>
      </ng-container>
    </div>

    <div class="entity-view__card__content">
      <md-input-container style="margin-right: 25px;" [class.error]="formInvalid && !entity.name" class="entity-view__card__content__item">
        <input autoFocus required md-input [disabled]="mode === view" placeholder="{{'PRODUCT_INFO_NAME' | translate}}" name="name" [(ngModel)]="entity.name" type="text">
      </md-input-container>

      <md-textarea [disabled]="mode === view" placeholder="{{'PRODUCT_INFO_DESCRIPTION' | translate}}" name="description" [(ngModel)]="entity.description" type="text" rows="2"></md-textarea>

      <div class="product-view__group">
        <md-input-container [class.error]="formInvalid && !entity.sku" class="entity-view__card__content__item">
          <input required md-input [disabled]="mode === view" placeholder="{{'PRODUCT_INFO_SKU' | translate}}" name="sku" [(ngModel)]="entity.sku" type="text">
        </md-input-container>
      </div>

      <div style="margin-top: 15px;" class="product-view__group">
        <md-input-container class="entity-view__card__content__item" [class.error]="formInvalid && defaultInvalid()">
          <input md-input currencyInput [initPrice]="entity.defaultPrice" (priceChanged)="priceUpdated($event)" [disabled]="mode === view" placeholder="{{'PRODUCT_INFO_DEFAULTPRICE' | translate}}" name="defaultPrice" (keydown)="isCurrency($event)" type="text">
        </md-input-container>

        <md-checkbox class="dynamic-checkbox" [disabled]="mode === view" [checked]="entity.dynamicPrice.enabled" (change)="toggleDynamic()">{{'PRODUCT_INFO_DYNAMICPRICE' | translate}}</md-checkbox>
      </div>

      <div *ngIf="entity.dynamicPrice.enabled" style="margin-top: 15px;" class="product-view__group">
        <md-input-container [class.error]="formInvalid && dynamicInvalid()" class="entity-view__card__content__item">
          <input md-input currencyInput autoFocus [initPrice]="entity.dynamicPrice.min" (priceChanged)="entity.dynamicPrice.min = $event" placeholder="{{'PRODUCT_INFO_MINPRICE' | translate}}" name="defaultPrice" (keydown)="isCurrency($event)" type="text">
        </md-input-container>

        <md-input-container [class.error]="formInvalid && dynamicInvalid()" class="entity-view__card__content__item">
          <input md-input currencyInput [initPrice]="entity.dynamicPrice.max" (priceChanged)="entity.dynamicPrice.max = $event" placeholder="{{'PRODUCT_INFO_MAXPRICE' | translate}}" name="defaultPrice" (keydown)="isCurrency($event)" type="text">
        </md-input-container>
      </div>

      <div style="margin-top: 15px;" class="product-view__group">
        <md-checkbox style="font-size: 14px;" [disabled]="mode === view" [checked]="entity.ship" (change)="toggleShip()">{{'PRODUCT_INFO_SHIP' | translate}}</md-checkbox>

        <md-input-container [class.error]="formInvalid && !entity.shippingDelay && entity.shippingDelay !== 0 && entity.ship" class="entity-view__card__content__item">
          <input [required]="entity.ship" md-input [disabled]="mode === view || !entity.ship" (keydown)="isNumeric($event)" placeholder="{{'PRODUCT_INFO_SHIPDELAY' | translate}}" name="shippingDelay" [(ngModel)]="entity.shippingDelay" type="number">
        </md-input-container>
      </div>

      <autocomplete-input class="product-autocomplete-input"
                          [class.error]="formInvalid && (!entity.fulfillmentProvider || !entity.fulfillmentProvider.id) && entity.ship"
                          [initialValue]="entity.fulfillmentProvider"
                          [placeholder]="'PRODUCT_INFO_FULFILLMENTPROVIDER' | translate"
                          [options]="fulfillmentProviderService.entities$ | async"
                          [mapFunction]="fulfillmentProviderMapper"
                          [showArrow]="true"
                          [disabled]="mode === view || !entity.ship"
                          [required]="entity.ship"
                          (selected)="entity.fulfillmentProvider = $event">
      </autocomplete-input>

    </div>

    <div *ngIf="mode !== view" class="entity-view__card__actions">
      <div (click)="cancelUpdate()">{{'PRODUCT_INFO_CANCEL' | translate}}</div>
      <div (click)="saveProduct(productInputForm.form.valid)">{{(mode === update ? 'PRODUCT_INFO_UPDATE' : 'PRODUCT_INFO_CREATE') | translate}}</div>
    </div>
  </div>
</form>

