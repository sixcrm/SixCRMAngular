<div  *ngIf="entity; else spinner" class="entity-view">
  <entity-view-breadcrumbs [items]="breadcrumbs"></entity-view-breadcrumbs>

  <div (click)="navigation.back()" class="entity-view__change-mode"><mat-icon>reply</mat-icon></div>

  <div class="entity-view__info">
    <div class="entity-view__info__image">
      <img src="/assets/images/result-item-customer-white.svg" alt="">
    </div>
    <div class="entity-view__info__data">
      <div class="entity-view__info__data__date">{{'SINGLEPAGE_CREATED' | translate}}: {{entity.createdAt | formatDateTime: 'date-time'}}</div>

      <form #inputForm="ngForm">
        <div class="entity-view__info__data__name">
          <span *ngIf="viewMode; else nameEdit">{{entity.name}}</span>

          <ng-template #nameEdit>
            <md-input #nameInputField [class.error]="formInvalid && !entity.name" required [(ngModel)]="entity.name" name="name"></md-input>
          </ng-template>
        </div>

        <div class="entity-view__info__data__other">
          <span class="entity-view__info__data__other__label">{{'AFFILIATE_INFO_ID' | translate}}:</span>
          <span *ngIf="viewMode; else affidEdit">{{entity.affiliateId}}</span>

          <ng-template #affidEdit>
            <md-input [class.error]="formInvalid && !entity.affiliateId" required [(ngModel)]="entity.affiliateId" name="affiliateId"></md-input>
          </ng-template>
        </div>
      </form>

    </div>

    <div class="entity-view__info__edit">
      <div *ngIf="viewMode; else editActions" class="entity-view__info__edit__update" (click)="editAffiliate()">{{'AFFILIATE_INFO_EDIT' | translate}}</div>

      <ng-template #editActions>
        <div *ngIf="updateMode" (click)="cancelEdit()">{{'AFFILIATE_INFO_CANCEL' | translate}}</div>
        <div class="entity-view__info__edit__update" (click)="saveAffiliate(inputForm.form.valid)">{{(updateMode ? 'AFFILIATE_INFO_UPDATE' : 'AFFILIATE_INFO_SAVE') | translate}}</div>
      </ng-template>
    </div>
  </div>

  <tab-header [elements]="tabHeaders" [selectedIndex]="selectedIndex" (select)="setIndex($event)"></tab-header>

  <md-tab-group *ngIf="!addMode" [(selectedIndex)]="selectedIndex">

    <md-tab>
      <div class="tab-container">
        <affiliate-trackers [affiliate]="entity"></affiliate-trackers>
      </div>
    </md-tab>

    <md-tab>
      <div class="tab-container">
        <affiliate-sessions [affiliateId]="entity.id"></affiliate-sessions>
      </div>
    </md-tab>

    <md-tab>
      <div class="tab-container">
        <affiliate-campaigns [affiliateId]="entity.id"></affiliate-campaigns>
      </div>
    </md-tab>

  </md-tab-group>
</div>

<ng-template #spinner>
  <spe-loader [numberOfTabs]="3" [cardsExpression]="'100%'" [title]="'AFFILIATE_INDEX_TITLE' | translate"></spe-loader>
</ng-template>
