<md-card class="customer-view__card notes">
  <md-card-title>
    <div class="title">{{'CUSTOMER_NOTES_TITLE' | translate}}</div>
    <div class="subtitle">{{'CUSTOMER_NOTES_SUBTITLE' | translate}}</div>

    <md-icon [md-menu-trigger-for]="creditCardOptions">more_vert</md-icon>
    <md-menu #creditCardOptions="mdMenu" x-position="before">
      <button md-menu-item (click)="newNote()">{{'CUSTOMER_NOTES_ADD' | translate}}</button>
    </md-menu>
  </md-card-title>
  <md-card-content>
    <div *ngIf="showNewNote" class="notes__new">
      <md-textarea [(ngModel)]="note"></md-textarea>

      <div class="notes__new__actions">
        <md-icon (click)="closeNote()" class="notes__new__actions__close">clear</md-icon>
        <md-icon (click)="saveNote()" class="notes__new__actions__done">done</md-icon>
      </div>
    </div>

    <div class="notes__container"
         infiniteScroll
         [infiniteScrollDistance]="2"
         [infiniteScrollThrottle]="300"
         [scrollWindow]="false"
         (scrolled)="onScroll()">

      <div class="note" *ngFor="let n of notes">
        <div class="note__title">
          <span class="note__title__label note__title__label--link" [routerLink]="['/users', n.user.id]">{{n.user.name}}</span>
          <md-icon>date_range</md-icon>
          <span class="notes__title__label">{{n.createdAt | formatDateTime}}</span>
          <md-icon>query_builder</md-icon>
          <span class="note__title__label">{{n.createdAt | formatDateTime: 'time'}}</span>
        </div>
        <div class="note__content">
          <div><img src="assets/images/alert-icon.svg"></div>
          <span>{{n.body}}</span>
          <md-icon class="note__content__action" [md-menu-trigger-for]="actionsMenu">more_vert</md-icon>

          <md-menu #actionsMenu="mdMenu" x-position="before">
            <button md-menu-item (click)="deleteEntity(n.id)">{{'CUSTOMER_NOTES_DEL' | translate}}</button>
          </md-menu>
        </div>
      </div>

      <server-error-message (refresh)="refreshData()" *ngIf="serverError; else message"></server-error-message>
      <ng-template #message>
        <table-loader *ngIf="loadingData"></table-loader>
        <div class="entity-view__no-results customer-view__no-results entity-view__no-results--small-padding" *ngIf="!loadingData && (!notes || notes.length === 0)">{{'CUSTOMER_NOTES_NODATA' | translate}}</div>
      </ng-template>
    </div>

  </md-card-content>
</md-card>
