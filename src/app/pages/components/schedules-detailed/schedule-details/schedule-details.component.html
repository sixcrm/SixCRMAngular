<div class="schedule-details" [class.schedule-details--hidden]="(!_scheduleBackup && !_productSchedule && !_product) || hideDetails">
  <div class="schedule-container tab-container--no-header">

    <schedule-details-header
      [product]="_product"
      [schedule]="_scheduleBackup"
      [productSchedule]="_productSchedule"
      (close)="closeModal()"
      (removeSchedule)="removeSchedule()"
      (removeProductSchedule)="removeProductSchedule()">
    </schedule-details-header>

    <schedule-details-title [imagePath]="imagePath" [nextCycle]="nextCycle"></schedule-details-title>

    <div class="schedule-tab-header">
      <div [class.selected]="selectedIndex === 0" (click)="selectedIndex = 0">Info</div>
      <div *ngIf="_productSchedule" [class.selected]="selectedIndex === 1" (click)="selectedIndex = 1">Cycles</div>
    </div>

    <md-tab-group [(selectedIndex)]="selectedIndex">
      <md-tab>
        <div *ngIf="_scheduleBackup" class="schedule-container__schedule-details">
          <div class="header"><div>Schedule</div></div>

          <div class="body">
            <div class="body__row">
              <mat-input-container>
                <input type="text" auto-focus matInput placeholder="Start" (keydown)="isNumeric($event)" [(ngModel)]="_scheduleBackup.start" (input)="recalculate()">
              </mat-input-container>

              <mat-input-container>
                <input type="text" matInput placeholder="End" (keydown)="isNumeric($event)" [(ngModel)]="_scheduleBackup.end" (input)="recalculate()">
              </mat-input-container>
            </div>

            <div class="body__row">
              <mat-input-container>
                <input type="text" matInput placeholder="Cycle" (keydown)="isNumeric($event)" [(ngModel)]="_scheduleBackup.period" (input)="recalculate()">
              </mat-input-container>

              <autocomplete-input
                [fullWidth]="true"
                [initialValue]="_scheduleBackup.product"
                [options]="allProducts"
                [applyAutofocus]="false"
                [placeholder]="'Product'"
                [mapFunction]="productMapper"
                (selected)="_scheduleBackup.product = $event">
              </autocomplete-input>
            </div>
          </div>

          <div class="header"><div>Pricing</div></div>

          <div class="body">
            <div class="body__row">
              <mat-input-container>
                <input type="text" matInput placeholder="Price" currencyInput [initPrice]="_scheduleBackup.price" (priceChanged)="_scheduleBackup.price = $event">
              </mat-input-container>
            </div>
          </div>

          <div class="buttons"><div (click)="saveSchedule()">SAVE</div></div>
        </div>

        <div *ngIf="_productSchedule" class="schedule-container__schedule-details">
          <div class="header"><div>Schedule</div></div>

          <div class="body">
            <div class="body__row">
              <mat-input-container>
                <input type="text" matInput disabled placeholder="Start" [(ngModel)]="_productSchedule.start">
              </mat-input-container>

              <mat-input-container>
                <input type="text" matInput disabled placeholder="End" [(ngModel)]="_productSchedule.end">
              </mat-input-container>
            </div>
          </div>

          <div class="header"><div>Pricing</div></div>

          <div class="body">
            <mat-input-container>
              <input type="text" matInput placeholder="Quantity" [(ngModel)]="_productSchedule.quantity">
            </mat-input-container>

            <mat-input-container>
              <input matInput disabled type="text" placeholder="Discount Code">
            </mat-input-container>
          </div>

          <div class="buttons"><div (click)="saveProductSchedule()">SAVE</div></div>
        </div>

        <div *ngIf="_product" class="schedule-container__schedule-details">
          <div class="header">
            <div>Pricing</div>
          </div>

          <div class="body">
            <mat-input-container>
              <input matInput disabled type="text" placeholder="Quantity" [(ngModel)]="_product.quantity">
            </mat-input-container>
            <mat-input-container>
              <input matInput disabled type="text" placeholder="Price" currencyInput [initPrice]="_product.price">
            </mat-input-container>
            <mat-input-container>
              <input matInput disabled type="text" placeholder="Discount Code">
            </mat-input-container>
          </div>
        </div>

      </md-tab>

      <md-tab>
        <div *ngIf="_productSchedule" class="schedule-container__items">

          <div class="item" *ngFor="let s of _productSchedule.schedules; let i = index">
            <div class="number"><span>{{i}}</span></div>
            <div class="text">{{s.product.name}}</div>
            <mat-icon [matMenuTriggerFor]="scheduleoptions">more_vert</mat-icon>
            <mat-menu #scheduleoptions="matMenu" x-position="before">
              <button md-menu-item [routerLink]="['/products', s.product.id]">View Product</button>
              <button md-menu-item (click)="deleteSchedule.emit(s)">Delete Schedule</button>
              <button md-menu-item (click)="focusSchedule.emit(s)">Focus Schedule</button>
            </mat-menu>
          </div>

          <div class="item">
            <autocomplete-input
              class="session-autocomplete"
              [initialValue]="productToAdd"
              [fullWidth]="true"
              [options]="allProducts"
              [applyAutofocus]="false"
              [placeholder]="'Add Product'"
              [mapFunction]="productMapper"
              (selected)="productToAdd = $event">
            </autocomplete-input>

            <mat-icon (click)="persistNewSchedule()">add</mat-icon>
          </div>
        </div>
      </md-tab>
    </md-tab-group>

  </div>
</div>
