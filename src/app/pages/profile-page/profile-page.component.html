<div class="entity-view">
  <div class="entity-view__title">{{'PROFILE_TITLE' | translate}}</div>

  <div (click)="navigation.back()" class="entity-view__change-mode"><mat-icon>reply</mat-icon></div>

  <div *ngIf="user">
    <div class="entity-view__info">
      <div class="entity-view__info__image entity-view__info__image--profile">
        <img src="{{ user.picture }}" alt="">
      </div>
      <div class="entity-view__info__data">
        <div class="entity-view__info__data__date">{{'PROFILE_CREATED' | translate}}: {{user.createdAt | formatDateTime}}</div>
        <div class="entity-view__info__data__name">{{user.name}}</div>
        <div class="entity-view__info__data__other">
          <span *ngIf="phone" class="entity-view__info__data__other__item"><mat-icon>phone</mat-icon>{{phone}}</span>
          <span class="entity-view__info__data__other__item"><mat-icon>email</mat-icon>{{user.email}}</span>
        </div>
      </div>
    </div>

    <tab-header [elements]="tabHeaders" [selectedIndex]="selectedIndex" (select)="setIndex($event)"></tab-header>

    <div class="profile-page__content">
      <mat-tab-group [(selectedIndex)]="selectedIndex">
        <mat-tab>
          <div *ngIf="userSettings" class="profile-page__content__general">
            <div class="profile-page__content__general__title">
              <div class="profile-page__content__general__title__main">{{'PROFILE_DETAILS_TITLE' | translate}}</div>
              <div class="profile-page__content__general__title__sub">{{'PROFILE_DETAILS_SUBTITLE' | translate}}</div>
              <!--<mat-icon>more_vert</mat-icon>-->
            </div>

            <div class="profile-page__content__general__data">
              <mat-input-container>
                <input matInput placeholder="{{'PROFILE_DETAILS_FIRSTNAME' | translate}}" [(ngModel)]="userBackup.firstName">
              </mat-input-container>
              <mat-input-container>
                <input matInput placeholder="{{'PROFILE_DETAILS_LASTNAME' | translate}}" [(ngModel)]="userBackup.lastName">
              </mat-input-container>
              <mat-input-container>
                <input matInput placeholder="{{'PROFILE_DETAILS_WORKPHONE' | translate}}" type="text" [textMask]="{mask: mask, guide: false}" [(ngModel)]="userSettingsBackup.workPhone">
              </mat-input-container>
              <mat-input-container>
                <input matInput placeholder="{{'PROFILE_DETAILS_CELLPHONE' | translate}}" type="text" [textMask]="{mask: mask, guide: false}" [(ngModel)]="userSettingsBackup.cellPhone">
              </mat-input-container>
              <div class="profile-page__content__general__data__dropdown">
                <autocomplete-input
                  [initialValue]="userSettingsBackup.timezone"
                  [options]="timezones"
                  [placeholder]="'PROFILE_DETAILS_TIMEZONE' | translate"
                  (selected)="userSettingsBackup.timezone = $event">
                </autocomplete-input>
              </div>

              <mat-input-container [class.error]="formInvalid && !validEmail()">
                <input matInput placeholder="{{'PROFILE_DETAILS_EMAIL' | translate}}" [(ngModel)]="user.email">
              </mat-input-container>

              <div class="profile-page__content__general__data__dropdown" *ngIf="translationsService.featureFlagService.isEnabled('user-settings-languages')">

                <dropdown-component
                  [selected]="userSettingsBackup.language || 'English'"
                  [placeholder]="'PROFILE_DETAILS_LANGUAGE' | translate"
                  [options]="translationsService.getLanguages()"
                  (onSelect)="setLanguage($event)">
                </dropdown-component>

              </div>
            </div>

            <div class="profile-page__content__general__button" (click)="updateUserDetails()">{{'PROFILE_DETAILS_UPDATE' | translate}}</div>
          </div>
        </mat-tab>

        <mat-tab>
          <notification-devices
            [settings]="userSettings"
            (sendTestNotification)="sendTestNotification()"
            (sendTestAlert)="sendTestAlert()"
            (settingToggled)="updateUserSettings()">
          </notification-devices>
        </mat-tab>

        <mat-tab>
          <notification-preferences
            [notificationSettings]="notificationSettings"
            (sendTestNotification)="sendTestNotification()"
            (sendTestAlert)="sendTestAlert()"
            (cancel)="cancelNotificationSettingsUpdate()"
            (save)="notificationSettingsUpdated()">
          </notification-preferences>
        </mat-tab>

        <mat-tab>
          <table-memory
            class="accounts-table"
            [data]="accounts"
            [columnParams]="accountColumnParams"
            [associationEnabled]="false"
            [dissociationEnabled]="false"
            (view)="viewAccount($event)"
            [textOptions]="accountTextOptions">
          </table-memory>
        </mat-tab>

        <mat-tab>
          <user-signing-strings></user-signing-strings>
        </mat-tab>

        <mat-tab>
          <agreements></agreements>
        </mat-tab>

      </mat-tab-group>
    </div>
  </div>
</div>

