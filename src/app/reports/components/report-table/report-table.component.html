<div class="reports-table">
  <div class="reports-table__title">
    <span>{{title | translate}}</span>
    <mat-input-container *ngIf="showFilter">
      <input matInput placeholder="Filter" [(ngModel)]="filterString">
    </mat-input-container>
    <table-pagination
      [class.reports-table__pagination--right]="!showFilter"
      [limit]="limit"
      [paginationValues]="paginationValues"
      [previousDisabled]="page <= 0"
      [nextDisabled]="nextDisabled"
      [paginationString]="paginationString"
      (previous)="previous.emit($event)"
      (next)="next.emit($event)"
      (updateLimit)="updateLimit.emit($event)">
    </table-pagination>
    <table-preferences
      [columnParams]="columnParams"
      [small]="true">
    </table-preferences>
    <mat-icon class="reports-table__title__icon--more" [matMenuTriggerFor]="downloadOptions">more_vert</mat-icon>
    <mat-menu #downloadOptions="matMenu" x-position="before">
      <button md-menu-item (click)="download.emit('json')"> {{'CHART_DOWNLOADJSON' | translate}}</button>
      <button md-menu-item> {{'CHART_DOWNLOADCSV' | translate}}</button>
      <button md-menu-item> {{'CHART_DOWNLOADEXCEL' | translate}}</button>
    </mat-menu>
  </div>

  <div class="reports-table__table-container" *ngIf="data; else transactionReportLoading">
    <table class="highlight">
      <thead>
        <tr>
          <ng-container *ngFor="let params of columnParams">
            <ng-container *ngIf="params.selected">
              <th (click)="setSortParams(params)" [class.cell--align-right]="params.align === 'right'">
                {{params.label | translate}}
                <ng-container *ngIf="params.sortApplied">
                  <mat-icon *ngIf="params.sortOrder === 'asc'; else downArrow;">keyboard_arrow_down</mat-icon>
                  <ng-template #downArrow><mat-icon>keyboard_arrow_up</mat-icon></ng-template>
                </ng-container>
              </th>
            </ng-container>
          </ng-container>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of data | filterEntitiesByParams: columnParams: filterString | sortEntities: sortParams.mappingFunction: sortParams.sortOrder">
          <ng-container *ngFor="let params of columnParams">
            <ng-container *ngIf="params.selected">
              <td [class.cell--align-right]="params.align === 'right'"
                  [class.cell--link]="params.isLink"
                  (click)="onCellClicked(params, d)"
                  [class.filter-cell]="params.isFilter">
                <ng-container *ngIf="params.number; else nan">{{params.mappingFunction(d) | numberlocale}}</ng-container>
                <ng-template #nan>{{params.mappingFunction(d)}}</ng-template>
              </td>
            </ng-container>
          </ng-container>
        </tr>
      </tbody>
    </table>

    <table-loader *ngIf="loading"></table-loader>

    <table-pagination
      [limit]="limit"
      [paginationValues]="paginationValues"
      [previousDisabled]="page <= 0"
      [nextDisabled]="nextDisabled"
      [paginationString]="paginationString"
      (previous)="previous.emit($event)"
      (next)="next.emit($event)"
      (updateLimit)="updateLimit.emit($event)">
    </table-pagination>
  </div>

  <ng-template #transactionReportLoading>
    <md-spinner></md-spinner>
  </ng-template>
</div>
