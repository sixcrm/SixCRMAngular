<div class="reports-table">
  <div class="reports-table__title">
    <span>{{title}}</span>
    <md-input *ngIf="showFilter" placeholder="Filter" [(ngModel)]="filterString"></md-input>
    <table-pagination
      [class.reports-table__pagination--right]="!showFilter"
      [limit]="limit"
      [paginationValues]="paginationValues"
      [previousDisabled]="page <= 0"
      [nextDisabled]="nextDisabled"
      [paginationString]="paginationString"
      (previous)="previous.emit($event)"
      (next)="next.emit($event)"
      (updateLimit)="updateLimit.emit($event)">
    </table-pagination>
    <md-icon class="reports-table__title__icon--more" [md-menu-trigger-for]="downloadOptions">more_vert</md-icon>
    <md-menu #downloadOptions="mdMenu" x-position="before">
      <button md-menu-item (click)="download.emit('json')"> Download JSON </button>
      <button md-menu-item> Download CSV </button>
      <button md-menu-item> Download Excel </button>
    </md-menu>
  </div>

  <div class="reports-table__table-container" *ngIf="data; else transactionReportLoading">
    <table class="highlight">
      <thead>
        <tr>
          <th *ngFor="let params of columnParams" (click)="setSortParams(params)" [class.cell--align-right]="params.align === 'right'">
            {{params.label}}
            <ng-container *ngIf="params.sortApplied">
              <md-icon *ngIf="params.sortOrder === 'asc'; else downArrow;">keyboard_arrow_down</md-icon>
              <ng-template #downArrow><md-icon>keyboard_arrow_up</md-icon></ng-template>
            </ng-container>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of data | filterEntitiesByParams: columnParams: filterString | sortEntities: sortParams.mappingFunction: sortParams.sortOrder">
          <td *ngFor="let params of columnParams"
              [class.cell--align-right]="params.align === 'right'"
              [class.cell--link]="params.isLink"
              (click)="onCellClicked(params, d)"
              [class.filter-cell]="params.isFilter">
            {{params.mappingFunction(d)}}</td>
        </tr>
      </tbody>
    </table>

    <table-loader *ngIf="loading"></table-loader>

    <table-pagination
      [limit]="limit"
      [paginationValues]="paginationValues"
      [previousDisabled]="page <= 0"
      [nextDisabled]="nextDisabled"
      [paginationString]="paginationString"
      (previous)="previous.emit($event)"
      (next)="next.emit($event)"
      (updateLimit)="updateLimit.emit($event)">
    </table-pagination>
  </div>

  <ng-template #transactionReportLoading>
    <md-spinner></md-spinner>
  </ng-template>
</div>
